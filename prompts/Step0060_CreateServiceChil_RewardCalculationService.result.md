{"additionalImports": ["java.math.BigDecimal", "java.time.LocalDate", "java.util.List"], "additionalJPAMethods": {"RewardRepository": ["List<Reward> findByAgencyAccountIdAndInvestmentTrustId(Integer agencyAccountId, Integer investmentTrustId)"], "FeeRepository": ["List<Fee> findByAgencyAccountIdAndInvestmentTrustId(Integer agencyAccountId, Integer investmentTrustId)"], "PaymentHistoryRepository": ["List<PaymentHistory> findByAgencyAccountId(Integer agencyAccountId)"]}, "methods": {"calculateReward": {"annotations": ["@Transactional", "@Override"], "body": "        Reward reward = rewardRepository.findByAgencyAccountIdAndInvestmentTrustId(requestBody.getAgencyAccountId(), requestBody.getInvestmentTrustId()).orElse(null);\n        if (reward == null) {\n            reward = Reward.builder()\n                    .agencyAccountId(requestBody.getAgencyAccountId())\n                    .investmentTrustId(requestBody.getInvestmentTrustId())\n                    .rewardAmount(BigDecimal.ZERO)\n                    .date(LocalDate.now())\n                    .build();\n        }\n        BigDecimal rewardAmount = BigDecimal.valueOf(requestBody.getInvestmentAmount()).multiply(BigDecimal.valueOf(0.01));\n        reward.setRewardAmount(reward.getRewardAmount().add(rewardAmount));\n        rewardRepository.save(reward);\n        return new RewardAmount(reward.getAgencyAccountId().toString(), reward.getInvestmentTrustId().toString(), reward.getRewardAmount().doubleValue(), reward.getDate());"}, "calculateFee": {"annotations": ["@Transactional", "@Override"], "body": "        Fee fee = feeRepository.findByAgencyAccountIdAndInvestmentTrustId(requestBody.getAgencyAccountId(), requestBody.getInvestmentTrustId()).orElse(null);\n        if (fee == null) {\n            fee = Fee.builder()\n                    .agencyAccountId(requestBody.getAgencyAccountId())\n                    .investmentTrustId(requestBody.getInvestmentTrustId())\n                    .feeAmount(BigDecimal.ZERO)\n                    .date(LocalDate.now())\n                    .build();\n        }\n        BigDecimal feeAmount = BigDecimal.valueOf(requestBody.getInvestmentAmount()).multiply(BigDecimal.valueOf(0.005));\n        fee.setFeeAmount(fee.getFeeAmount().add(feeAmount));\n        feeRepository.save(fee);\n        return new FeeAmount(fee.getAgencyAccountId().toString(), fee.getInvestmentTrustId().toString(), fee.getFeeAmount().doubleValue(), fee.getDate());"}, "createPaymentHistory": {"annotations": ["@Transactional", "@Override"], "body": "        PaymentHistory paymentHistory = PaymentHistory.builder()\n                .agencyAccountId(requestBody.getAgencyAccountId())\n                .paymentType(requestBody.getPaymentType())\n                .amount(BigDecimal.valueOf(requestBody.getAmount()))\n                .date(LocalDate.now())\n                .build();\n        paymentHistoryRepository.save(paymentHistory);\n        return paymentHistory;"}, "getPaymentHistory": {"annotations": ["@Transactional", "@Override"], "body": "        List<PaymentHistory> paymentHistories = paymentHistoryRepository.findByAgencyAccountId(agencyAccountId);\n        return paymentHistories;"}} }